# Project Cordelia - Technical Implementation Document (First Prototype)
## Shakespeare Text Display 

**Version:** 0.1 (First Prototype)  
**Date:** July 21, 2025  

---

## 1. Overview

Build a Streamlit app that displays King Lear from a TEI XML file with scene navigation.

## 2. Setup

### 2.1 Dependencies
```bash
# Create virtual environment with uv
uv init project-cordelia
cd project-cordelia
uv venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Install required packages
uv add streamlit lxml beautifulsoup4
```

### 2.2 Project Structure
```
project-cordelia/
â”œâ”€â”€ app.py              # Main Streamlit application
â”œâ”€â”€ parser.py           # TEI XML parser
â”œâ”€â”€ data/
â”‚   â””â”€â”€ king_lear.xml   # TEI XML file (provided)
â””â”€â”€ requirements.txt    # Generated by uv
```

## 3. Data Model

```python
# parser.py
from dataclasses import dataclass
from typing import List

@dataclass
class Scene:
    act_number: str
    scene_number: str
    title: str
    content: str  # Formatted text with speakers and stage directions

@dataclass
class Act:
    number: str
    title: str
    scenes: List[Scene]

@dataclass
class Play:
    title: str
    acts: List[Act]
    all_scenes: List[Scene]  # Flat list for easy access
```

## 4. TEI Parser

```python
# parser.py
import xml.etree.ElementTree as ET
from typing import List

class TEIParser:
    def __init__(self, xml_path: str):
        self.xml_path = xml_path
    
    def parse(self) -> Play:
        """Parse TEI XML and return Play object"""
        try:
            tree = ET.parse(self.xml_path)
            root = tree.getroot()
            
            # Extract title
            title = self._get_title(root)
            
            # Parse acts and scenes
            acts = self._parse_acts(root)
            
            # Create flat scene list
            all_scenes = []
            for act in acts:
                all_scenes.extend(act.scenes)
            
            return Play(title=title, acts=acts, all_scenes=all_scenes)
            
        except Exception as e:
            raise Exception(f"Failed to parse XML: {e}")
    
    def _parse_acts(self, root) -> List[Act]:
        # Implementation: Extract acts and scenes
        # Format content with ** for speakers, * for stage directions
        pass
```

## 5. Streamlit Application

```python
# app.py
import streamlit as st
from parser import TEIParser

# Page config
st.set_page_config(
    page_title="King Lear - Project Cordelia",
    layout="wide"
)

# Parse XML once
@st.cache_data
def load_play():
    try:
        parser = TEIParser("data/king_lear.xml")
        return parser.parse()
    except Exception as e:
        st.error(f"Failed to load play: {e}")
        st.stop()

# Load data
play = load_play()

# Initialize session state
if 'current_scene_id' not in st.session_state:
    st.session_state.current_scene_id = None

# Layout
col1, col2 = st.columns([1, 3])

# Sidebar navigation
with col1:
    st.header("Scenes")
    
    # Show all scenes button
    if st.button("ðŸ“– Show Full Play", use_container_width=True):
        st.session_state.current_scene_id = None
    
    # Act/Scene navigation
    for act in play.acts:
        st.subheader(act.title)
        for scene in act.scenes:
            scene_id = f"{act.number}_{scene.scene_number}"
            if st.button(scene.title, key=scene_id, use_container_width=True):
                st.session_state.current_scene_id = scene_id

# Main content
with col2:
    st.title(play.title)
    
    if st.session_state.current_scene_id is None:
        # Show entire play
        for act in play.acts:
            st.header(act.title)
            for scene in act.scenes:
                st.subheader(scene.title)
                st.markdown(scene.content)
    else:
        # Show selected scene
        act_num, scene_num = st.session_state.current_scene_id.split('_')
        for scene in play.all_scenes:
            if scene.act_number == act_num and scene.scene_number == scene_num:
                st.subheader(f"{scene.title}")
                st.markdown(scene.content)
                break
```

## 6. Text Formatting

When parsing TEI XML, format text as:
- **SPEAKER.** Text of speech
- *Stage directions in italics*
- Preserve line breaks for verse

## 7. Error Handling

Basic error messages only:
- Missing XML file: "Failed to load play: [error]"
- Parse error: "Failed to parse XML: [error]"
- Let Streamlit handle other errors with default behavior

## 8. Running the Prototype

```bash
# Activate environment
source .venv/bin/activate

# Run Streamlit
uv run streamlit run app.py

# Opens at http://localhost:8501
```

---

**Note:** This is a minimal first prototype focusing only on core functionality.